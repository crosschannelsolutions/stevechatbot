async function sendMessage() {
    const userInput = document.getElementById("user-input").value.trim();
    if (!userInput) return;

    const chatBox = document.getElementById("chat-box");
    chatBox.innerHTML += `<div class="user-message">${userInput}</div>`;
    document.getElementById("user-input").value = "";

    const botMessageDiv = document.createElement("div");
    botMessageDiv.className = "bot-message";
    chatBox.appendChild(botMessageDiv);

    try {
        const response = await fetch("https://stevechatbot.vercel.app/api/chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ messages: [{ role: "user", content: userInput }] })
        });

        const reader = response.body.getReader();
        const decoder = new TextDecoder();
        let botMessage = "";

        while (true) {
            const { done, value } = await reader.read();
            if (done) break;

            let newText = decoder.decode(value);
            newText = newText.split("\n").filter(line => line.startsWith("data:")).map(line => {
                try {
                    return JSON.parse(line.replace("data: ", "")).text;
                } catch {
                    return "";
                }
            }).join("");

            botMessage += newText;
            botMessageDiv.innerHTML = botMessage; // ✅ Append only the new text

            chatBox.scrollTop = chatBox.scrollHeight;
        }

    } catch (error) {
        console.error("❌ Fetch Error:", error);
        botMessageDiv.innerHTML = "Sorry, an error occurred.";
    }
}
